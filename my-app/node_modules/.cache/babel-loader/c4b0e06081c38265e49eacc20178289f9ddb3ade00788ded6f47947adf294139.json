{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{MessageCircle,X,Send}from'lucide-react';import api from'../api';import'./ChatBot.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatBot=_ref=>{let{user}=_ref;const[isOpen,setIsOpen]=useState(false);const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[isLoading,setIsLoading]=useState(false);const messagesEndRef=useRef(null);// Initial greeting\nuseEffect(()=>{if(messages.length===0){setMessages([{_id:'init',message:\"Hi! I'm the EventSphere Assistant. How can I help you today?\",isBot:true,timestamp:new Date()}]);}},[]);// Scroll to bottom\nuseEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});},[messages,isOpen]);// Fetch history if logged in\nuseEffect(()=>{if(isOpen&&user){const fetchHistory=async()=>{try{const res=await api.get('/chat/history');if(res.data&&res.data.length>0){setMessages(res.data);}}catch(error){console.error(\"Failed to load chat history\",error);}};fetchHistory();}},[isOpen,user]);const handleSend=async e=>{e.preventDefault();if(!input.trim())return;const tempId=Date.now();const userMsg={_id:tempId,message:input,isBot:false,timestamp:new Date()};setMessages(prev=>[...prev,userMsg]);setInput('');setIsLoading(true);try{const token=localStorage.getItem('token');if(token){// Authenticated chat\nconst res=await api.post('/chat/send',{message:userMsg.message});setMessages(prev=>{// Replace temp message if needed, or just append bot response\n// Here we just append the real saved messages from DB to be safe, \n// or just append bot response if we want to accept the optimistic update\nreturn[...prev.filter(m=>m._id!==tempId),res.data.userMessage,res.data.botMessage];});}else{// Unauthenticated fallback (simulated)\nsetTimeout(()=>{setMessages(prev=>[...prev,{_id:Date.now()+1,message:\"Please sign in to chat with our support bot.\",isBot:true,timestamp:new Date()}]);},500);}}catch(error){console.error(\"Chat error\",error);setMessages(prev=>[...prev,{_id:Date.now()+1,message:\"Sorry, I'm having trouble connecting right now.\",isBot:true,timestamp:new Date()}]);}finally{setIsLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-container\",children:[!isOpen&&/*#__PURE__*/_jsx(\"button\",{className:\"chatbot-toggle\",onClick:()=>setIsOpen(true),children:/*#__PURE__*/_jsx(MessageCircle,{size:28})}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-window\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"EventSphere Support\"}),/*#__PURE__*/_jsx(\"button\",{className:\"chatbot-close\",onClick:()=>setIsOpen(false),children:/*#__PURE__*/_jsx(X,{size:20})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chatbot-messages\",children:[messages.map(msg=>/*#__PURE__*/_jsx(\"div\",{className:\"message \".concat(msg.isBot?'bot':'user'),children:msg.message},msg._id||Math.random())),isLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"message bot\",children:\"Typing...\"}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"chatbot-input\",onSubmit:handleSend,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Ask a question...\",value:input,onChange:e=>setInput(e.target.value),disabled:isLoading}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading||!input.trim(),children:/*#__PURE__*/_jsx(Send,{size:18})})]})]})]});};export default ChatBot;","map":{"version":3,"names":["React","useState","useEffect","useRef","MessageCircle","X","Send","api","jsx","_jsx","jsxs","_jsxs","ChatBot","_ref","user","isOpen","setIsOpen","messages","setMessages","input","setInput","isLoading","setIsLoading","messagesEndRef","length","_id","message","isBot","timestamp","Date","_messagesEndRef$curre","current","scrollIntoView","behavior","fetchHistory","res","get","data","error","console","handleSend","e","preventDefault","trim","tempId","now","userMsg","prev","token","localStorage","getItem","post","filter","m","userMessage","botMessage","setTimeout","className","children","onClick","size","map","msg","concat","Math","random","ref","onSubmit","type","placeholder","value","onChange","target","disabled"],"sources":["D:/project/my-app/src/components/ChatBot.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { MessageCircle, X, Send } from 'lucide-react';\r\nimport api from '../api';\r\nimport './ChatBot.css';\r\n\r\nconst ChatBot = ({ user }) => {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [messages, setMessages] = useState([]);\r\n    const [input, setInput] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const messagesEndRef = useRef(null);\r\n\r\n    // Initial greeting\r\n    useEffect(() => {\r\n        if (messages.length === 0) {\r\n            setMessages([\r\n                {\r\n                    _id: 'init',\r\n                    message: \"Hi! I'm the EventSphere Assistant. How can I help you today?\",\r\n                    isBot: true,\r\n                    timestamp: new Date()\r\n                }\r\n            ]);\r\n        }\r\n    }, []);\r\n\r\n    // Scroll to bottom\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [messages, isOpen]);\r\n\r\n    // Fetch history if logged in\r\n    useEffect(() => {\r\n        if (isOpen && user) {\r\n            const fetchHistory = async () => {\r\n                try {\r\n                    const res = await api.get('/chat/history');\r\n                    if (res.data && res.data.length > 0) {\r\n                        setMessages(res.data);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Failed to load chat history\", error);\r\n                }\r\n            };\r\n            fetchHistory();\r\n        }\r\n    }, [isOpen, user]);\r\n\r\n    const handleSend = async (e) => {\r\n        e.preventDefault();\r\n        if (!input.trim()) return;\r\n\r\n        const tempId = Date.now();\r\n        const userMsg = {\r\n            _id: tempId,\r\n            message: input,\r\n            isBot: false,\r\n            timestamp: new Date()\r\n        };\r\n\r\n        setMessages(prev => [...prev, userMsg]);\r\n        setInput('');\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const token = localStorage.getItem('token');\r\n            if (token) {\r\n                // Authenticated chat\r\n                const res = await api.post('/chat/send', { message: userMsg.message });\r\n                setMessages(prev => {\r\n                    // Replace temp message if needed, or just append bot response\r\n                    // Here we just append the real saved messages from DB to be safe, \r\n                    // or just append bot response if we want to accept the optimistic update\r\n                    return [...prev.filter(m => m._id !== tempId), res.data.userMessage, res.data.botMessage];\r\n                });\r\n            } else {\r\n                // Unauthenticated fallback (simulated)\r\n                setTimeout(() => {\r\n                    setMessages(prev => [...prev, {\r\n                        _id: Date.now() + 1,\r\n                        message: \"Please sign in to chat with our support bot.\",\r\n                        isBot: true,\r\n                        timestamp: new Date()\r\n                    }]);\r\n                }, 500);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Chat error\", error);\r\n            setMessages(prev => [...prev, {\r\n                _id: Date.now() + 1,\r\n                message: \"Sorry, I'm having trouble connecting right now.\",\r\n                isBot: true,\r\n                timestamp: new Date()\r\n            }]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"chatbot-container\">\r\n            {!isOpen && (\r\n                <button className=\"chatbot-toggle\" onClick={() => setIsOpen(true)}>\r\n                    <MessageCircle size={28} />\r\n                </button>\r\n            )}\r\n\r\n            {isOpen && (\r\n                <div className=\"chatbot-window\">\r\n                    <div className=\"chatbot-header\">\r\n                        <h3>EventSphere Support</h3>\r\n                        <button className=\"chatbot-close\" onClick={() => setIsOpen(false)}>\r\n                            <X size={20} />\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className=\"chatbot-messages\">\r\n                        {messages.map((msg) => (\r\n                            <div key={msg._id || Math.random()} className={`message ${msg.isBot ? 'bot' : 'user'}`}>\r\n                                {msg.message}\r\n                            </div>\r\n                        ))}\r\n                        {isLoading && <div className=\"message bot\">Typing...</div>}\r\n                        <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    <form className=\"chatbot-input\" onSubmit={handleSend}>\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Ask a question...\"\r\n                            value={input}\r\n                            onChange={(e) => setInput(e.target.value)}\r\n                            disabled={isLoading}\r\n                        />\r\n                        <button type=\"submit\" disabled={isLoading || !input.trim()}>\r\n                            <Send size={18} />\r\n                        </button>\r\n                    </form>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChatBot;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}